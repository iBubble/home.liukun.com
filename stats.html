<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Stats - Gemini's Home</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- 版本: 2026-01-09-v6 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff41;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* 背景效果 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(10, 10, 30, 0.2) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(20, 10, 30, 0.2) 0%, transparent 50%);
            z-index: -2;
        }

        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }

        /* 导航栏 */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            z-index: 100;
            border-bottom: 2px solid #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logo:hover {
            color: #ff00ff;
            text-shadow: 0 0 15px #ff00ff;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 2rem;
        }

        nav a {
            color: #00ffff;
            text-decoration: none;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
        }

        nav a:hover {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }

        /* 主容器 */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 100px 2rem 2rem;
        }

        h1 {
            font-size: 3rem;
            color: #00ffff;
            text-align: center;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.3rem;
            text-shadow: 0 0 20px #00ffff;
        }

        .subtitle {
            text-align: center;
            color: #ff00ff;
            font-size: 1.2rem;
            margin-bottom: 3rem;
            letter-spacing: 0.2rem;
        }

        /* 状态卡片网格 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #00ffff;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #ff00ff;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 255, 255, 0.1), transparent);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .stat-label {
            color: #00ffff;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .stat-value {
            font-size: 2.5rem;
            color: #ff00ff;
            font-weight: bold;
            text-shadow: 0 0 20px #ff00ff;
            position: relative;
            z-index: 1;
        }

        .stat-unit {
            font-size: 1rem;
            color: #00ff41;
            margin-top: 0.5rem;
            position: relative;
            z-index: 1;
        }

        /* 图表容器 */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #00ff41;
            padding: 1.5rem;
            position: relative;
        }

        .chart-container:hover {
            border-color: #ff00ff;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
        }

        .chart-title {
            color: #00ffff;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* 系统信息 */
        .system-info {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #00ffff;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .system-info h2 {
            color: #ff00ff;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .info-label {
            color: #00ffff;
        }

        .info-value {
            color: #00ff41;
            font-weight: bold;
        }

        /* 状态指示器 */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        .status-online {
            background: #00ff41;
            box-shadow: 0 0 10px #00ff41;
        }

        .status-warning {
            background: #ffff00;
            box-shadow: 0 0 10px #ffff00;
        }

        .status-offline {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }

            nav {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }
        }

        /* 服务状态指示灯 */
        .service-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.4rem 0.6rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 4px;
            transition: all 0.3s;
        }

        .service-indicator:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(0, 255, 255, 0.6);
        }

        .service-indicator .status-indicator {
            width: 12px;
            height: 12px;
        }

        .service-name {
            color: #00ffff;
            font-weight: bold;
            min-width: 80px;
        }

        .service-status-text {
            color: #00ff41;
            font-size: 0.9rem;
        }

        .service-status-text.offline {
            color: #ff0000;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .project-card {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #00ffff;
            overflow: hidden;
            transition: all 0.3s;
            position: relative;
        }

        .project-card:hover {
            border-color: #ff00ff;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
            transform: translateY(-5px);
        }

        .project-thumbnail {
            width: 100%;
            height: 200px;
            overflow: hidden;
            position: relative;
            background: #000;
        }

        .project-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .project-card:hover .project-thumbnail img {
            transform: scale(1.1);
        }

        .project-info {
            padding: 1.5rem;
        }

        .project-name {
            color: #00ffff;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .project-desc {
            color: #00ff41;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .project-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .project-link {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            color: #00ffff;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .project-link:hover {
            background: rgba(255, 0, 255, 0.2);
            border-color: #ff00ff;
            color: #ff00ff;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        }

        /* 加载动画 */
        .loading {
            text-align: center;
            color: #00ffff;
            font-size: 1.2rem;
            padding: 2rem;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav>
        <a href="index.html" class="logo">Gemini</a>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="stats.html">Stats</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>[ Server Statistics ]</h1>
        <p class="subtitle">// Real-time System Monitoring //</p>

        <!-- 实时状态卡片 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">
                    <span class="status-indicator status-online"></span>
                    System Status
                </div>
                <div class="stat-value" id="systemStatus">Online</div>
                <div class="stat-unit">Running</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">CPU Usage</div>
                <div class="stat-value" id="cpuUsage">--</div>
                <div class="stat-unit">%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Memory Usage</div>
                <div class="stat-value" id="memUsage">--</div>
                <div class="stat-unit">%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Disk Usage</div>
                <div class="stat-value" id="diskUsage">--</div>
                <div class="stat-unit">%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Network Traffic</div>
                <div class="stat-value" id="networkTraffic">--</div>
                <div class="stat-unit">KB/s</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">System Load</div>
                <div class="stat-value" id="systemLoad">--</div>
                <div class="stat-unit">1min Avg</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Uptime</div>
                <div class="stat-value" id="uptime">--</div>
                <div class="stat-unit">Days</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Connections</div>
                <div class="stat-value" id="connections">--</div>
                <div class="stat-unit">Connections</div>
            </div>
        </div>

        <!-- 系统信息 -->
        <div class="system-info">
            <h2>&gt; System Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Hostname:</span>
                    <span class="info-value" id="hostname">ubuntu</span>
                </div>
                <div class="info-item">
                    <span class="info-label">OS:</span>
                    <span class="info-value" id="os">Ubuntu 24.04.3 LTS</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Kernel:</span>
                    <span class="info-value" id="kernel">6.8.0-90-generic</span>
                </div>
                <div class="info-item">
                    <span class="info-label">CPU:</span>
                    <span class="info-value" id="cpu">AMD Ryzen 5 3600X</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total Memory:</span>
                    <span class="info-value" id="totalMem">7.7 GB</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total Disk:</span>
                    <span class="info-value" id="totalDisk">97 GB</span>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="charts-grid">
            <!-- CPU使用率图表 -->
            <div class="chart-container">
                <div class="chart-title">CPU Usage History</div>
                <div class="chart-wrapper">
                    <canvas id="cpuChart"></canvas>
                </div>
            </div>

            <!-- 内存使用率图表 -->
            <div class="chart-container">
                <div class="chart-title">Memory Usage History</div>
                <div class="chart-wrapper">
                    <canvas id="memChart"></canvas>
                </div>
            </div>

            <!-- 网络流量图表 -->
            <div class="chart-container">
                <div class="chart-title">Network Traffic</div>
                <div class="chart-wrapper">
                    <canvas id="networkChart"></canvas>
                </div>
            </div>

            <!-- 磁盘使用率图表 -->
            <div class="chart-container">
                <div class="chart-title">Disk Usage</div>
                <div class="chart-wrapper">
                    <canvas id="diskChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 服务状态 -->
        <div class="system-info">
            <h2>&gt; Services Status</h2>
            <div class="services-grid">
                <div class="service-indicator">
                    <span class="status-indicator status-online"></span>
                    <span class="service-name">Nginx</span>
                    <span class="service-status-text">Running</span>
                </div>
                <div class="service-indicator">
                    <span class="status-indicator status-online"></span>
                    <span class="service-name">MySQL</span>
                    <span class="service-status-text">Running</span>
                </div>
                <div class="service-indicator">
                    <span class="status-indicator status-online"></span>
                    <span class="service-name">PHP-FPM</span>
                    <span class="service-status-text">Running</span>
                </div>
                <div class="service-indicator">
                    <span class="status-indicator status-online"></span>
                    <span class="service-name">Docker</span>
                    <span class="service-status-text">Running</span>
                </div>
                <div class="service-indicator">
                    <span class="status-indicator status-online"></span>
                    <span class="service-name">Fail2ban</span>
                    <span class="service-status-text">Running</span>
                </div>
                <div class="service-indicator">
                    <span class="status-indicator status-online"></span>
                    <span class="service-name">SSL Cert</span>
                    <span class="service-status-text">Valid (89 days)</span>
                </div>
            </div>
        </div>

        <!-- 项目状态 -->
        <div class="system-info">
            <h2>&gt; Deployed Web Projects</h2>
            <div class="projects-grid">
                <div class="project-card">
                    <div class="project-thumbnail">
                        <img src="/Samples/AIMovie/screenshot.jpg" alt="AIMovie" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Cdefs%3E%3ClinearGradient id=%22g1%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22%3E%3Cstop offset=%220%25%22 style=%22stop-color:%23001a33;stop-opacity:1%22/%3E%3Cstop offset=%22100%25%22 style=%22stop-color:%23003366;stop-opacity:1%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill=%22url(%23g1)%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2245%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300ffff%22 font-family=%22monospace%22 font-size=%2232%22 font-weight=%22bold%22%3E时光大师%3C/text%3E%3Ctext x=%2250%25%22 y=%2260%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23ff00ff%22 font-family=%22monospace%22 font-size=%2218%22%3EAI影视平台%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="project-info">
                        <div class="project-name">时光大师 AI影视平台</div>
                        <div class="project-desc">AI驱动的影视创作平台，支持剧本生成、角色匹配、分镜制作等功能</div>
                        <div class="project-status">
                            <span class="status-indicator status-online"></span>
                            <span class="info-value">Online</span>
                        </div>
                        <a href="/Samples/AIMovie/" class="project-link" target="_blank">访问项目 →</a>
                    </div>
                </div>

                <div class="project-card">
                    <div class="project-thumbnail">
                        <img src="/Samples/Exam/screenshot.jpg" alt="Exam" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Cdefs%3E%3ClinearGradient id=%22g2%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22%3E%3Cstop offset=%220%25%22 style=%22stop-color:%23331a00;stop-opacity:1%22/%3E%3Cstop offset=%22100%25%22 style=%22stop-color:%23663300;stop-opacity:1%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill=%22url(%23g2)%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2245%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300ff41%22 font-family=%22monospace%22 font-size=%2232%22 font-weight=%22bold%22%3E在线考试%3C/text%3E%3Ctext x=%2250%25%22 y=%2260%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300ffff%22 font-family=%22monospace%22 font-size=%2218%22%3EExam System%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="project-info">
                        <div class="project-name">在线考试系统</div>
                        <div class="project-desc">完整的在线考试管理系统，支持学生管理、试题管理、成绩统计等功能</div>
                        <div class="project-status">
                            <span class="status-indicator status-online"></span>
                            <span class="info-value">Online</span>
                        </div>
                        <a href="/Samples/Exam/" class="project-link" target="_blank">访问项目 →</a>
                    </div>
                </div>

                <div class="project-card">
                    <div class="project-thumbnail">
                        <img src="/Samples/Proxy/screenshot.jpg" alt="Proxy" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Cdefs%3E%3ClinearGradient id=%22g3%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22%3E%3Cstop offset=%220%25%22 style=%22stop-color:%23330033;stop-opacity:1%22/%3E%3Cstop offset=%22100%25%22 style=%22stop-color:%23660066;stop-opacity:1%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill=%22url(%23g3)%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2245%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23ff00ff%22 font-family=%22monospace%22 font-size=%2232%22 font-weight=%22bold%22%3E代理测试%3C/text%3E%3Ctext x=%2250%25%22 y=%2260%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300ffff%22 font-family=%22monospace%22 font-size=%2218%22%3EProxy Test%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="project-info">
                        <div class="project-name">代理测试项目</div>
                        <div class="project-desc">用于测试和验证代理服务器功能的工具项目</div>
                        <div class="project-status">
                            <span class="status-indicator status-online"></span>
                            <span class="info-value">Online</span>
                        </div>
                        <a href="/Samples/Proxy/Proxy.php" class="project-link" target="_blank">访问项目 →</a>
                    </div>
                </div>

                <div class="project-card">
                    <div class="project-thumbnail">
                        <img src="/Samples/Shangri-la/screenshot.jpg" alt="Shangri-la" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Cdefs%3E%3ClinearGradient id=%22g4%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22%3E%3Cstop offset=%220%25%22 style=%22stop-color:%23003333;stop-opacity:1%22/%3E%3Cstop offset=%22100%25%22 style=%22stop-color:%23006666;stop-opacity:1%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill=%22url(%23g4)%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2240%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300ffff%22 font-family=%22monospace%22 font-size=%2228%22 font-weight=%22bold%22%3E天空之境%3C/text%3E%3Ctext x=%2250%25%22 y=%2255%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23ff00ff%22 font-family=%22monospace%22 font-size=%2224%22%3E数智香格里拉%3C/text%3E%3Ctext x=%2250%25%22 y=%2270%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300ff41%22 font-family=%22monospace%22 font-size=%2214%22%3EShangri-la%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="project-info">
                        <div class="project-name">天空之境·数智香格里拉</div>
                        <div class="project-desc">智慧旅游平台，展示香格里拉的美景与文化</div>
                        <div class="project-status">
                            <span class="status-indicator status-online"></span>
                            <span class="info-value">Online</span>
                        </div>
                        <a href="/Samples/Shangri-la/" class="project-link" target="_blank">访问项目 →</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API配置
        const API_URL = '/api/server-stats.php';
        const UPDATE_INTERVAL = 5000; // 5秒更新一次

        // 历史数据存储
        const historyData = {
            cpu: [],
            memory: [],
            network: { rx: [], tx: [] },
            labels: []
        };

        // Chart.js 配置
        const chartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#00ffff'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    min: 0,
                    max: 100,
                    grid: {
                        color: 'rgba(0, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#00ff41'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#00ff41',
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        };

        // 网络图表配置（不同的Y轴范围）
        const networkChartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#00ffff'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    min: 0,
                    grid: {
                        color: 'rgba(0, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#00ff41'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#00ff41',
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        };

        // 初始化图表
        const cpuChart = new Chart(document.getElementById('cpuChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'CPU Usage (%)',
                    data: [],
                    borderColor: '#00ffff',
                    backgroundColor: 'rgba(0, 255, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartConfig
        });

        const memChart = new Chart(document.getElementById('memChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Memory Usage (%)',
                    data: [],
                    borderColor: '#ff00ff',
                    backgroundColor: 'rgba(255, 0, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartConfig
        });

        const networkChart = new Chart(document.getElementById('networkChart'), {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Download (KB/s)',
                    data: [],
                    backgroundColor: 'rgba(0, 255, 255, 0.6)',
                    borderColor: '#00ffff',
                    borderWidth: 1
                }, {
                    label: 'Upload (KB/s)',
                    data: [],
                    backgroundColor: 'rgba(255, 0, 255, 0.6)',
                    borderColor: '#ff00ff',
                    borderWidth: 1
                }]
            },
            options: networkChartConfig
        });

        const diskChart = new Chart(document.getElementById('diskChart'), {
            type: 'doughnut',
            data: {
                labels: ['Used', 'Free'],
                datasets: [{
                    data: [0, 100],
                    backgroundColor: [
                        'rgba(255, 0, 255, 0.6)',
                        'rgba(0, 255, 255, 0.2)'
                    ],
                    borderColor: ['#ff00ff', '#00ffff'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ffff'
                        }
                    }
                }
            }
        });

        // 获取服务器数据
        async function fetchServerStats() {
            try {
                console.log('正在获取服务器数据...');
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                const data = await response.json();
                console.log('服务器数据获取成功:', data);
                updateUI(data);
            } catch (error) {
                console.error('获取服务器数据失败:', error);
                document.getElementById('systemStatus').textContent = 'Error';
                const statusIndicator = document.getElementById('systemStatus').parentElement.querySelector('.status-indicator');
                if (statusIndicator) {
                    statusIndicator.className = 'status-indicator status-offline';
                }
            }
        }

        // 更新UI
        function updateUI(data) {
            // 更新System Status为Online
            document.getElementById('systemStatus').textContent = 'Online';
            const statusIndicator = document.getElementById('systemStatus').parentElement.querySelector('.status-indicator');
            if (statusIndicator) {
                statusIndicator.className = 'status-indicator status-online';
            }

            // 更新状态卡片
            document.getElementById('cpuUsage').textContent = data.cpu.usage.toFixed(1);
            document.getElementById('memUsage').textContent = data.memory.usage.toFixed(1);
            document.getElementById('diskUsage').textContent = data.disk.usage.toFixed(1);
            
            // 网络流量（下载+上传）
            const totalTraffic = (data.network.rx_rate + data.network.tx_rate).toFixed(1);
            document.getElementById('networkTraffic').textContent = totalTraffic;
            
            // 系统负载
            document.getElementById('systemLoad').textContent = data.load['1min'];
            
            document.getElementById('uptime').textContent = (data.system.uptime.days + data.system.uptime.hours / 24).toFixed(2);
            document.getElementById('connections').textContent = data.connections.established || 0;

            // 更新系统信息
            document.getElementById('hostname').textContent = data.system.hostname;
            document.getElementById('os').textContent = data.system.os;
            document.getElementById('kernel').textContent = data.system.kernel;
            document.getElementById('cpu').textContent = data.cpu.model;
            document.getElementById('totalMem').textContent = data.memory.total + ' GB';
            document.getElementById('totalDisk').textContent = data.disk.total;

            // 更新服务状态
            updateServiceStatus('nginx', data.services.nginx);
            updateServiceStatus('mysql', data.services.mysql);
            updateServiceStatus('php-fpm', data.services['php-fpm']);
            updateServiceStatus('docker', data.services.docker);
            updateServiceStatus('fail2ban', data.services.fail2ban);

            // 更新SSL证书状态
            updateSSLStatus(data.ssl);

            // 更新图表
            updateCharts(data);
        }

        // 更新服务状态
        function updateServiceStatus(serviceName, isActive) {
            const serviceIndicators = document.querySelectorAll('.service-indicator');
            serviceIndicators.forEach(el => {
                const nameSpan = el.querySelector('.service-name');
                if (nameSpan && nameSpan.textContent.toLowerCase().includes(serviceName.toLowerCase())) {
                    const indicator = el.querySelector('.status-indicator');
                    const statusText = el.querySelector('.service-status-text');
                    if (isActive) {
                        indicator.className = 'status-indicator status-online';
                        statusText.textContent = 'Running';
                        statusText.className = 'service-status-text';
                    } else {
                        indicator.className = 'status-indicator status-offline';
                        statusText.textContent = 'Stopped';
                        statusText.className = 'service-status-text offline';
                    }
                }
            });
        }

        // 更新SSL证书状态
        function updateSSLStatus(sslData) {
            const serviceIndicators = document.querySelectorAll('.service-indicator');
            serviceIndicators.forEach(el => {
                const nameSpan = el.querySelector('.service-name');
                if (nameSpan && nameSpan.textContent.includes('SSL')) {
                    const indicator = el.querySelector('.status-indicator');
                    const statusText = el.querySelector('.service-status-text');
                    if (sslData && sslData.valid) {
                        indicator.className = 'status-indicator status-online';
                        statusText.textContent = `Valid (${sslData.days_remaining} days)`;
                        statusText.className = 'service-status-text';
                    } else {
                        indicator.className = 'status-indicator status-warning';
                        statusText.textContent = sslData && sslData.message ? sslData.message : 'Unknown';
                        statusText.className = 'service-status-text offline';
                    }
                }
            });
        }

        // 更新图表
        function updateCharts(data) {
            const now = new Date().toLocaleTimeString();

            // 如果这是第一次真实数据，清除初始占位数据
            if (historyData.cpu[0] === 0 && historyData.memory[0] === 0 && data.memory.usage > 0) {
                console.log('清除初始占位数据，开始使用真实数据');
                historyData.labels = [];
                historyData.cpu = [];
                historyData.memory = [];
                historyData.network.rx = [];
                historyData.network.tx = [];
            }

            // 添加到历史数据
            historyData.labels.push(now);
            historyData.cpu.push(data.cpu.usage);
            historyData.memory.push(data.memory.usage);
            historyData.network.rx.push(data.network.rx_rate || 0);
            historyData.network.tx.push(data.network.tx_rate || 0);

            // 保持最多20个数据点
            const maxPoints = 20;
            if (historyData.labels.length > maxPoints) {
                historyData.labels.shift();
                historyData.cpu.shift();
                historyData.memory.shift();
                historyData.network.rx.shift();
                historyData.network.tx.shift();
            }

            console.log('更新图表数据:', {
                时间: now,
                标签数: historyData.labels.length,
                CPU数据: historyData.cpu,
                内存数据: historyData.memory,
                网络下载: historyData.network.rx,
                网络上传: historyData.network.tx
            });

            // 更新CPU图表
            cpuChart.data.labels = [...historyData.labels];
            cpuChart.data.datasets[0].data = [...historyData.cpu];
            cpuChart.update();
            console.log('CPU图表已更新，数据点数:', cpuChart.data.labels.length);

            // 更新内存图表
            memChart.data.labels = [...historyData.labels];
            memChart.data.datasets[0].data = [...historyData.memory];
            memChart.update();
            console.log('内存图表已更新，数据点数:', memChart.data.labels.length);

            // 更新网络图表
            networkChart.data.labels = [...historyData.labels];
            networkChart.data.datasets[0].data = [...historyData.network.rx];
            networkChart.data.datasets[1].data = [...historyData.network.tx];
            networkChart.update();
            console.log('网络图表已更新，数据点数:', networkChart.data.labels.length);

            // 更新磁盘图表（饼图）
            diskChart.data.datasets[0].data = [
                data.disk.usage,
                100 - data.disk.usage
            ];
            diskChart.update();
            console.log('磁盘图表已更新');
        }

        // 初始化 - 确保DOM加载完成
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM加载完成，开始初始化...');
                initCharts();
                fetchServerStats();
                setInterval(fetchServerStats, UPDATE_INTERVAL);
            });
        } else {
            console.log('DOM已加载，立即初始化...');
            initCharts();
            fetchServerStats();
            setInterval(fetchServerStats, UPDATE_INTERVAL);
        }

        // 初始化图表 - 添加一些初始数据点以确保图表可见
        function initCharts() {
            console.log('初始化图表...');
            // 添加初始空数据点
            for (let i = 0; i < 5; i++) {
                const time = new Date(Date.now() - (5 - i) * 5000).toLocaleTimeString();
                historyData.labels.push(time);
                historyData.cpu.push(0);
                historyData.memory.push(0);
                historyData.network.rx.push(0);
                historyData.network.tx.push(0);
            }
            
            // 更新图表显示初始数据
            cpuChart.data.labels = [...historyData.labels];
            cpuChart.data.datasets[0].data = [...historyData.cpu];
            cpuChart.update();
            
            memChart.data.labels = [...historyData.labels];
            memChart.data.datasets[0].data = [...historyData.memory];
            memChart.update();
            
            networkChart.data.labels = [...historyData.labels];
            networkChart.data.datasets[0].data = [...historyData.network.rx];
            networkChart.data.datasets[1].data = [...historyData.network.tx];
            networkChart.update();
            
            console.log('图表初始化完成，初始数据点:', historyData.labels.length);
        }
    </script>
</body>
</html>
