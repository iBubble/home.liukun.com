# 大学考试刷题工具 - 部署说明

## 📅 迁移时间
2026-01-09

## 🎯 项目信息

### 原服务器
- **域名**：exam.liukun.com
- **SSH**：root@exam.liukun.com
- **密码**：Gl5181081
- **路径**：/www/wwwroot/exam

### 新服务器
- **域名**：home.liukun.com
- **路径**：/www/wwwroot/ibubble.vicp.net/Samples/Exam
- **访问地址**：https://home.liukun.com:8443/Samples/Exam/

### 数据库配置
- **主机**：home.liukun.com
- **端口**：3306
- **数据库名**：exam
- **用户名**：exam
- **密码**：Gl5181081

## 📋 迁移步骤

### 1. 文件迁移
```bash
# 创建目录
mkdir -p /www/wwwroot/ibubble.vicp.net/Samples/Exam

# 从远程服务器拉取文件
sshpass -p 'Gl5181081' scp -r root@exam.liukun.com:/www/wwwroot/exam/* Samples/Exam/
```

### 2. 数据库配置修改
修改文件：`inc/db.inc.php`

```php
<?php
// 数据库连接配置文件
$db_host = 'localhost';
$db_port = '3306';
$db_user = 'exam';
$db_pass = 'Gl5181081';
$db_name = 'exam';
$db_socket = '/tmp/mysql.sock';  // 指定socket路径

try {
    $pdo = new PDO(
        "mysql:unix_socket=$db_socket;dbname=$db_name;charset=utf8mb4",
        $db_user,
        $db_pass,
        [...]
    );
} catch (PDOException $e) {
    error_log("数据库连接失败: " . $e->getMessage());
    die("数据库连接失败，请稍后重试");
}
?>
```

**重要说明**：
- ✅ 使用 `unix_socket` 连接方式（而非host:port）
- ✅ Socket路径：`/tmp/mysql.sock`
- ✅ 这样可以避免"No such file or directory"错误

### 3. 权限设置
```bash
# 设置所有者
chown -R gemini:www Samples/Exam

# 设置目录权限
find Samples/Exam -type d -exec chmod 775 {} \;

# 设置文件权限
find Samples/Exam -type f -exec chmod 664 {} \;
```

### 4. 更新samples.html
在 `/www/wwwroot/ibubble.vicp.net/samples.html` 中添加Exam项目链接。

## 🔧 配置文件说明

### 数据库配置
- **文件**：`inc/db.inc.php`
- **说明**：数据库连接配置，已修改为连接home.liukun.com服务器

### 主要功能文件
- `index.php` - 学生登录页面
- `exam_list.php` - 考试列表
- `exam_start.php` - 开始考试
- `exam.php` - 考试进行中
- `exam_result.php` - 考试结果
- `records.php` - 考试记录
- `wrong_questions.php` - 错题本

### 管理后台
- **路径**：`admin/`
- **登录页**：`admin/login.php`
- **功能**：
  - 题库管理
  - 试卷管理
  - 学生管理
  - 成绩统计
  - 操作日志

## 📁 目录结构

```
Samples/Exam/
├── admin/              # 管理后台
│   ├── css/           # 后台样式
│   ├── login.php      # 管理员登录
│   ├── index.php      # 后台首页
│   ├── questions.php  # 题库管理
│   ├── papers.php     # 试卷管理
│   ├── students.php   # 学生管理
│   └── ...
├── css/               # 前端样式
├── images/            # 图片资源
├── inc/               # 核心文件
│   ├── db.inc.php    # 数据库配置
│   ├── functions.inc.php  # 公共函数
│   └── ...
├── uploads/           # 上传文件
├── vendor/            # Composer依赖
├── index.php          # 学生登录
├── exam_list.php      # 考试列表
├── exam.php           # 考试页面
└── ...
```

## 🌐 访问地址

### 学生端
- **登录页**：https://home.liukun.com:8443/Samples/Exam/
- **考试列表**：https://home.liukun.com:8443/Samples/Exam/exam_list.php
- **错题本**：https://home.liukun.com:8443/Samples/Exam/wrong_questions.php

### 管理端
- **登录页**：https://home.liukun.com:8443/Samples/Exam/admin/login.php
- **后台首页**：https://home.liukun.com:8443/Samples/Exam/admin/

## ✅ 验证清单

### 1. 文件完整性
- [ ] 所有PHP文件已迁移
- [ ] CSS/JS文件已迁移
- [ ] 图片资源已迁移
- [ ] Composer依赖已迁移

### 2. 数据库连接
- [ ] 数据库配置已修改
- [ ] 可以正常连接数据库
- [ ] 数据表完整

### 3. 功能测试
- [ ] 学生登录功能正常
- [ ] 考试列表显示正常
- [ ] 开始考试功能正常
- [ ] 提交答案功能正常
- [ ] 查看成绩功能正常
- [ ] 错题本功能正常

### 4. 管理后台
- [ ] 管理员登录正常
- [ ] 题库管理功能正常
- [ ] 试卷管理功能正常
- [ ] 学生管理功能正常
- [ ] 统计功能正常

### 5. 权限设置
- [ ] 文件所有者正确（gemini:www）
- [ ] 目录权限正确（775）
- [ ] 文件权限正确（664）

## 🔍 测试步骤

### 1. 测试数据库连接
访问：https://home.liukun.com:8443/Samples/Exam/
- 如果能看到登录页面，说明数据库连接正常

### 2. 测试学生登录
- 使用测试账号登录
- 查看考试列表
- 尝试开始一次考试

### 3. 测试管理后台
访问：https://home.liukun.com:8443/Samples/Exam/admin/login.php
- 使用管理员账号登录
- 查看各个管理功能

## ⚠️ 注意事项

### 1. 数据库
- 数据库在home.liukun.com服务器上
- 确保数据库用户exam有远程访问权限
- 数据库名、用户名、密码都是exam/exam/Gl5181081

### 2. 文件上传
- uploads目录需要写入权限
- 如果有文件上传功能，确保权限正确

### 3. Session
- PHP session配置正常
- session文件可以正常写入

### 4. 路径问题
- 所有相对路径应该正常工作
- 如果有绝对路径，需要检查并修改

## 🐛 常见问题

### 问题1：数据库连接失败
**原因**：数据库配置不正确或数据库用户没有远程访问权限
**解决**：
1. 检查 `inc/db.inc.php` 配置
2. 确保数据库用户exam可以从home.liukun.com访问

### 问题2：页面显示空白
**原因**：PHP错误或权限问题
**解决**：
1. 检查PHP错误日志
2. 确保文件权限正确
3. 检查PHP版本兼容性

### 问题3：无法上传文件
**原因**：uploads目录权限不足
**解决**：
```bash
chmod 775 Samples/Exam/uploads
```

### 问题4：Session问题
**原因**：Session目录权限或配置问题
**解决**：
1. 检查PHP session配置
2. 确保session目录可写

## 📞 技术支持

如有问题，请检查：
1. PHP错误日志
2. Nginx错误日志
3. 数据库连接日志

## 📝 更新日志

### 2026-01-09
- ✅ 文件从exam.liukun.com迁移到home.liukun.com
- ✅ 修改数据库配置指向home.liukun.com
- ✅ 设置正确的文件权限
- ✅ 更新samples.html添加项目链接
- ✅ 创建部署说明文档

---

**迁移完成时间**：2026-01-09  
**状态**：✅ 已完成  
**访问地址**：https://home.liukun.com:8443/Samples/Exam/
