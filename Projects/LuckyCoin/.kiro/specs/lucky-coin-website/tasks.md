# 实施计划：《一元奇梦 Lucky Coin》电影项目网站

## 概述

本实施计划将《一元奇梦》网站的设计转化为可执行的开发任务。采用增量开发方式，每个任务都建立在前一个任务的基础上，确保代码持续集成和功能逐步完善。

## 任务列表

- [x] 1. 项目初始化和基础架构
  - 创建 React + TypeScript + Vite 项目
  - 配置 Tailwind CSS 和 CSS Modules
  - 设置 ESLint 和 Prettier
  - 配置路由系统（React Router）
  - 设置状态管理（Zustand）
  - 创建基础目录结构
  - _需求：所有需求的基础_

- [ ] 2. 色彩和字体系统实现
  - [x] 2.1 实现色彩系统配置
    - 创建 `styles/colors.ts` 定义梦境和现实色彩
    - 实现色彩主题切换逻辑
    - 配置 Tailwind 自定义色彩
    - _需求：2.1, 2.2_

  - [ ] 2.2 编写色彩系统属性测试
    - **属性 4：模式与色彩系统的一致性**
    - **验证需求：2.1, 2.2**

  - [x] 2.3 实现字体系统
    - 配置故障感标题字体
    - 配置打字机风格正文字体
    - 配置中文字体（思源黑体）
    - 创建 `styles/typography.ts` 定义字体大小系统
    - _需求：2.7, 2.8_


- [ ] 3. 模式管理系统
  - [x] 3.1 实现模式状态管理
    - 创建 `stores/modeStore.ts` 使用 Zustand
    - 实现模式切换逻辑（dream/reality）
    - 实现模式持久化到 localStorage
    - _需求：1.7, 1.8_

  - [ ] 3.2 编写模式切换往返属性测试
    - **属性 3：模式切换的往返一致性**
    - **验证需求：1.8**

  - [x] 3.3 实现 ModeToggle 组件
    - 创建 `components/ModeToggle/index.tsx`
    - 实现切换按钮 UI（金色硬币 vs 灰色缝纫机图标）
    - 实现切换动画（翻转 + 色彩渐变）
    - 实现主题应用逻辑
    - _需求：1.7, 1.8_

  - [ ] 3.4 编写 ModeToggle 组件单元测试
    - 测试切换功能
    - 测试图标显示
    - _需求：1.7, 1.8_

- [ ] 4. 老虎机入口组件
  - [x] 4.1 实现 SlotMachine 组件基础结构
    - 创建 `components/SlotMachine/index.tsx`
    - 实现老虎机 UI 布局
    - 实现"投币"按钮
    - _需求：1.1, 1.2_

  - [x] 4.2 实现老虎机转动逻辑
    - 实现概率计算函数（10% 梦境，90% 现实）
    - 实现转动动画（使用 Framer Motion）
    - 实现结果显示逻辑
    - _需求：1.2, 1.3, 1.5_

  - [ ]* 4.3 编写老虎机概率分布属性测试
    - **属性 1：老虎机概率分布**
    - **验证需求：1.3, 1.5**

  - [x] 4.4 实现结果特效
    - 实现金币雨动画（Canvas 粒子系统）
    - 实现走音喇叭音效
    - 实现转场动画
    - _需求：1.3, 1.4, 1.5, 1.6_

  - [ ]* 4.5 编写结果映射属性测试
    - **属性 2：结果到模式的映射一致性**
    - **验证需求：1.4, 1.6**

- [ ] 5. 检查点 - 核心交互完成
  - 确保老虎机和模式切换功能正常工作
  - 确保所有测试通过
  - 如有问题请向用户反馈

- [ ] 6. 故障艺术效果组件
  - [x] 6.1 实现 GlitchEffect 组件
    - 创建 `components/GlitchEffect/index.tsx`
    - 实现雪花点效果（Canvas）
    - 实现色彩分离效果（RGB 通道偏移）
    - 实现画面扭曲效果（CSS clip-path）
    - _需求：8.1, 8.2_

  - [ ] 6.2 实现故障效果触发逻辑
    - 实现页面切换时触发
    - 实现随机触发（梦境模式每 30-60 秒）
    - 实现手动触发接口
    - _需求：8.1, 8.4, 8.5_

  - [ ]* 6.3 编写故障效果非阻塞属性测试
    - **属性 9：故障效果的非阻塞性**
    - **验证需求：8.6**

  - [ ] 6.4 实现性能优化和可访问性
    - 移动设备降低复杂度
    - 提供关闭选项
    - _需求：8.7, 8.8_

- [ ] 7. 光标轨迹效果组件
  - [x] 7.1 实现 CursorTrail 组件
    - 创建 `components/CursorTrail/index.tsx`
    - 实现鼠标追踪逻辑
    - 实现针头光标图标
    - 实现轨迹绘制（SVG path）
    - _需求：9.1, 9.2, 9.3_

  - [ ] 7.2 实现轨迹样式和淡出
    - 实现虚线样式和针脚效果
    - 实现 2-3 秒淡出动画
    - 限制轨迹数量以保证性能
    - _需求：9.3, 9.4, 9.8_

  - [ ]* 7.3 编写光标轨迹颜色映射属性测试
    - **属性 10：光标轨迹颜色与模式的映射**
    - **验证需求：9.5, 9.6**

  - [ ] 7.4 实现设备适配
    - 移动设备禁用轨迹效果
    - _需求：9.7_

- [ ] 8. 对比滑块组件
  - [x] 8.1 实现 SliderComparison 组件
    - 创建 `components/SliderComparison/index.tsx`
    - 实现左右分屏布局
    - 实现滑块手柄 UI
    - _需求：3.1, 3.2, 3.3_

  - [x] 8.2 实现滑块拖动逻辑
    - 实现鼠标拖动处理
    - 实现触摸拖动处理
    - 实时更新左右内容比例
    - _需求：3.4_

  - [ ]* 8.3 编写滑块位置线性关系属性测试
    - **属性 5：滑块位置与可见区域的线性关系**
    - **验证需求：3.4**

  - [ ]* 8.4 编写滑块位置持久性属性测试
    - **属性 6：滑块位置的持久性**
    - **验证需求：3.8**

  - [ ] 8.5 实现响应式适配
    - 移动端改为上下滑动
    - _需求：10.4_

- [ ] 9. 角色卡牌组件
  - [x] 9.1 实现 CharacterCard 组件
    - 创建 `components/CharacterCard/index.tsx`
    - 实现卡牌布局（头像、属性面板）
    - 实现 RPG 风格属性显示
    - 实现必杀技信息显示
    - _需求：4.1, 4.2, 4.3, 4.4, 4.5_

  - [x] 9.2 实现卡牌交互效果
    - 实现悬停动画（放大 + 阴影）
    - 实现 3D 翻转动画
    - 实现点击弹窗
    - _需求：4.6, 4.8_

  - [ ]* 9.3 编写卡牌点击交互单元测试
    - 测试点击触发弹窗
    - _需求：4.8_

- [ ] 10. 检查点 - 核心组件完成
  - 确保所有核心组件正常工作
  - 确保所有测试通过
  - 如有问题请向用户反馈


- [ ] 11. 页面实现 - 首页
  - [-] 11.1 实现首页布局
    - 创建 `pages/Home/index.tsx`
    - 集成 SlotMachine 组件
    - 实现加载动画
    - _需求：1.1_

  - [ ]* 11.2 编写首页渲染单元测试
    - 测试老虎机组件显示
    - _需求：1.1_

- [ ] 12. 页面实现 - 故事板页面
  - [ ] 12.1 实现故事板页面
    - 创建 `pages/Story/index.tsx`
    - 集成 SliderComparison 组件
    - 准备梦境和现实场景内容
    - 实现反讽文案显示
    - _需求：3.1, 3.2, 3.3, 3.5, 3.6_

  - [ ]* 12.2 编写故事板页面单元测试
    - 测试滑块组件集成
    - 测试文案显示
    - _需求：3.5, 3.6_

- [ ] 13. 页面实现 - 角色页面
  - [ ] 13.1 实现角色页面
    - 创建 `pages/Characters/index.tsx`
    - 实现角色卡牌网格布局
    - 集成 CharacterCard 组件
    - 实现角色详情弹窗
    - _需求：4.1_

  - [ ]* 13.2 编写角色页面单元测试
    - 测试卡牌网格显示
    - 测试弹窗功能
    - _需求：4.1, 4.8_

- [ ] 14. 页面实现 - 导演风格页面
  - [ ] 14.1 实现导演风格页面
    - 创建 `pages/Director/index.tsx`
    - 实现参考片单展示
    - 实现音乐播放器组件
    - 集成音乐小样（混音版）
    - _需求：5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

  - [ ] 14.2 实现音乐播放控制
    - 实现播放/暂停功能
    - 实现音量调节
    - _需求：5.7_

  - [ ]* 14.3 编写音乐播放控制单元测试
    - 测试播放状态转换
    - _需求：5.7_

- [ ] 15. 页面实现 - 众筹页面
  - [ ] 15.1 实现众筹页面 UI
    - 创建 `pages/Crowdfunding/index.tsx`
    - 实现"一元预订"入口
    - 实现表单 UI（姓名、邮箱、手机）
    - _需求：6.1, 6.2, 6.3_

  - [ ] 15.2 实现表单验证逻辑
    - 创建 `utils/validation.ts`
    - 实现邮箱格式验证
    - 实现手机号码格式验证
    - 实现前端实时验证
    - _需求：6.4, 6.5_

  - [ ]* 15.3 编写表单验证属性测试
    - **属性 7：表单输入验证的完整性**
    - **验证需求：6.4, 6.5**

  - [ ] 15.4 实现表单提交和反馈
    - 实现提交逻辑
    - 实现成功消息显示
    - 实现错误消息显示
    - _需求：6.7, 6.8_

- [ ] 16. 页面实现 - 投资人专区
  - [ ] 16.1 实现投资人专区页面
    - 创建 `pages/Investor/index.tsx`
    - 实现标题和介绍文案
    - 实现数据可视化图表（使用 Chart.js 或 Recharts）
    - 实现联系方式展示
    - _需求：7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

  - [ ] 16.2 实现图表交互
    - 实现悬停显示详细信息
    - _需求：7.7, 7.8_

  - [ ]* 16.3 编写图表交互单元测试
    - 测试悬停显示功能
    - _需求：7.8_

- [ ] 17. 检查点 - 所有页面完成
  - 确保所有页面正常渲染
  - 确保页面间导航正常
  - 确保所有测试通过
  - 如有问题请向用户反馈

- [ ] 18. 后端 API 实现 - 基础架构
  - [ ] 18.1 初始化后端项目
    - 创建 Node.js + Express 项目
    - 配置 TypeScript
    - 设置项目结构（routes, controllers, services, models）
    - 配置环境变量
    - _需求：所有后端需求的基础_

  - [ ] 18.2 配置数据库连接
    - 安装 PostgreSQL 客户端
    - 创建数据库连接配置
    - 实现连接池
    - _需求：6.6, 13.6_

  - [ ] 18.3 创建数据库表
    - 创建 users 表
    - 创建 contents 表
    - 创建 analytics 表
    - 创建 characters 表
    - 添加索引
    - _需求：6.6, 13.6, 14.1_

- [ ] 19. 后端 API 实现 - 用户管理
  - [ ] 19.1 实现用户 API
    - 创建 `routes/users.ts`
    - 实现 POST /api/users（创建用户）
    - 实现 GET /api/users/:id（获取用户）
    - 实现后端验证逻辑
    - _需求：6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

  - [ ]* 19.2 编写用户 API 集成测试
    - 测试创建和获取用户
    - _需求：6.6_

  - [ ]* 19.3 编写数据持久化往返属性测试
    - **属性 8：数据持久化的往返一致性**
    - **验证需求：6.6**

- [ ] 20. 后端 API 实现 - 内容管理
  - [ ] 20.1 实现内容管理 API
    - 创建 `routes/content.ts`
    - 实现 GET /api/contents（获取所有内容）
    - 实现 GET /api/contents/:key（获取特定内容）
    - 实现 PUT /api/contents/:key（更新内容）
    - _需求：13.1, 13.2, 13.3, 13.4_

  - [ ] 20.2 实现认证中间件
    - 创建 `middleware/auth.ts`
    - 实现 JWT 认证
    - 保护管理员路由
    - _需求：13.1_

  - [ ]* 20.3 编写内容管理 API 单元测试
    - 测试 CRUD 操作
    - 测试认证保护
    - _需求：13.3, 13.4_

- [ ] 21. 后端 API 实现 - 角色管理
  - [ ] 21.1 实现角色管理 API
    - 创建 `routes/characters.ts`
    - 实现 GET /api/characters（获取所有角色）
    - 实现 GET /api/characters/:id（获取特定角色）
    - _需求：4.1_

  - [ ]* 21.2 编写角色 API 单元测试
    - 测试角色数据获取
    - _需求：4.1_

- [ ] 22. 后端 API 实现 - 数据分析
  - [ ] 22.1 实现分析 API
    - 创建 `routes/analytics.ts`
    - 实现 POST /api/analytics/event（记录事件）
    - 实现 GET /api/analytics/summary（获取摘要）
    - _需求：14.1, 14.2, 14.3, 14.4, 14.5, 14.6_

  - [ ]* 22.2 编写分析 API 单元测试
    - 测试事件记录
    - 测试数据查询
    - _需求：14.1_

- [ ] 23. 检查点 - 后端 API 完成
  - 确保所有 API 端点正常工作
  - 确保数据库操作正确
  - 确保所有测试通过
  - 如有问题请向用户反馈


- [ ] 24. 前后端集成
  - [ ] 24.1 实现 API 客户端
    - 创建 `utils/api.ts`
    - 实现统一的 API 调用函数
    - 实现错误处理
    - 实现请求重试逻辑
    - _需求：所有需要 API 调用的功能_

  - [ ] 24.2 集成用户预订功能
    - 连接众筹页面表单到后端 API
    - 实现数据提交和反馈
    - _需求：6.6, 6.7, 6.8_

  - [ ] 24.3 集成数据分析
    - 实现事件追踪（页面浏览、老虎机结果、模式切换等）
    - 连接到后端分析 API
    - _需求：14.1, 14.2, 14.3, 14.4, 14.5, 14.6_

  - [ ]* 24.4 编写前后端集成测试
    - 测试完整的用户预订流程
    - 测试数据分析事件记录
    - _需求：6.6, 14.1_

- [ ] 25. 响应式设计实现
  - [ ] 25.1 实现响应式布局
    - 配置 Tailwind 断点
    - 实现桌面布局（≥1024px）
    - 实现平板布局（768-1023px）
    - 实现移动布局（<768px）
    - _需求：10.1, 10.2, 10.3_

  - [ ]* 25.2 编写响应式布局断点属性测试
    - **属性 11：响应式布局的断点一致性**
    - **验证需求：10.1, 10.2, 10.3**

  - [ ] 25.3 实现移动端特定调整
    - 滑块改为上下滑动
    - 角色卡牌单列显示
    - 简化动画效果
    - _需求：10.4, 10.5, 10.6_

  - [ ] 25.4 实现可读性和触摸目标
    - 确保最小字号 14px
    - 确保触摸目标 ≥44x44px
    - _需求：10.7, 10.8_

  - [ ]* 25.5 编写触摸目标最小尺寸属性测试
    - **属性 12：触摸目标的最小尺寸**
    - **验证需求：10.8**

- [ ] 26. 性能优化
  - [ ] 26.1 实现代码分割
    - 使用 React.lazy 和 Suspense
    - 实现路由级代码分割
    - _需求：11.2_

  - [ ] 26.2 实现图片优化
    - 转换图片为 WebP 格式
    - 实现响应式图片
    - 实现图片懒加载
    - _需求：11.2, 11.3_

  - [ ] 26.3 实现资源优化
    - 压缩和合并 CSS/JS
    - 配置 CDN
    - 实现浏览器缓存策略
    - _需求：11.4, 11.6, 11.7_

  - [ ]* 26.4 编写首屏加载性能属性测试
    - **属性 13：首屏加载性能**
    - **验证需求：11.1**

  - [ ] 26.5 实现性能监控
    - 集成 Web Vitals
    - 实现性能指标上报
    - _需求：11.5_

- [ ] 27. 可访问性实现
  - [ ] 27.1 实现基础可访问性
    - 为所有图片添加 alt 文本
    - 使用语义化 HTML 标签
    - 实现键盘导航支持
    - 实现焦点指示器
    - _需求：12.1, 12.2, 12.3, 12.7_

  - [ ]* 27.2 编写键盘导航完整性属性测试
    - **属性 15：键盘导航的完整性**
    - **验证需求：12.2, 12.3**

  - [ ] 27.3 实现对比度和辅助功能
    - 确保文字对比度 ≥4.5:1
    - 实现音频静音控制
    - 实现"减少动画"选项
    - _需求：12.4, 12.5, 12.6_

  - [ ]* 27.4 编写文字对比度属性测试
    - **属性 14：文字对比度的可访问性**
    - **验证需求：12.4**

  - [ ] 27.5 实现屏幕阅读器支持
    - 添加 ARIA 标签
    - 测试屏幕阅读器兼容性
    - _需求：12.8_

- [ ] 28. 多语言支持
  - [ ] 28.1 实现国际化基础架构
    - 安装 i18n 库（react-i18next）
    - 配置语言文件（zh-CN, en, it）
    - 实现语言检测和自动选择
    - _需求：15.1, 15.2_

  - [ ] 28.2 实现语言切换功能
    - 实现语言切换菜单
    - 实现语言切换逻辑
    - 实现语言偏好保存
    - _需求：15.3, 15.4, 15.5, 15.6_

  - [ ]* 28.3 编写语言切换性能属性测试
    - **属性 18：语言切换的性能**
    - **验证需求：15.4**

  - [ ]* 28.4 编写语言切换状态保持属性测试
    - **属性 19：语言切换的状态保持**
    - **验证需求：15.5**

  - [ ] 28.5 翻译所有内容
    - 翻译 UI 文本
    - 翻译文案内容
    - 适配不同语言的字体
    - _需求：15.7, 15.8_

- [ ] 29. 管理后台实现
  - [ ] 29.1 实现管理员登录
    - 创建登录页面
    - 实现 JWT 认证
    - 实现登录状态管理
    - _需求：13.1_

  - [ ] 29.2 实现内容管理界面
    - 创建内容管理页面
    - 实现内容编辑功能
    - 实现图片上传功能
    - _需求：13.2, 13.3, 13.4_

  - [ ] 29.3 实现角色管理界面
    - 创建角色管理页面
    - 实现角色信息编辑
    - _需求：13.5_

  - [ ] 29.4 实现用户数据管理
    - 创建用户数据查看页面
    - 实现数据导出功能
    - _需求：13.6_

  - [ ] 29.5 实现内容更新同步
    - 实现前台内容自动刷新
    - 确保 5 秒内更新
    - _需求：13.7_

  - [ ]* 29.6 编写内容更新时效性属性测试
    - **属性 16：内容更新的时效性**
    - **验证需求：13.7**

  - [ ] 29.7 实现版本历史记录
    - 实现内容修改历史记录
    - 实现历史版本查看
    - _需求：13.8_

  - [ ]* 29.8 编写版本历史完整性属性测试
    - **属性 17：版本历史的完整性**
    - **验证需求：13.8**

- [ ] 30. 检查点 - 功能完整性验证
  - 确保所有功能正常工作
  - 确保所有属性测试通过
  - 确保所有单元测试通过
  - 如有问题请向用户反馈

- [ ] 31. 端到端测试
  - [ ] 31.1 编写关键用户流程 E2E 测试
    - 测试老虎机到预订的完整流程
    - 测试模式切换和页面导航
    - 测试表单提交流程
    - _需求：所有核心功能_

  - [ ] 31.2 编写跨浏览器测试
    - 测试 Chrome 兼容性
    - 测试 Firefox 兼容性
    - 测试 Safari 兼容性
    - _需求：所有核心功能_

  - [ ]* 31.3 编写性能 E2E 测试
    - 测试首屏加载时间
    - 测试交互响应时间
    - _需求：11.1_

- [ ] 32. 部署准备
  - [ ] 32.1 配置生产环境
    - 配置环境变量
    - 配置 Vercel 部署（前端）
    - 配置 Railway 部署（后端）
    - _需求：所有需求_

  - [ ] 32.2 配置监控和日志
    - 集成 Sentry 错误监控
    - 集成 Google Analytics
    - 配置后端日志系统
    - _需求：14.1_

  - [ ] 32.3 配置安全措施
    - 配置 HTTPS
    - 配置安全头（helmet）
    - 配置 CORS
    - 配置速率限制
    - _需求：所有需求_

  - [ ] 32.4 配置备份策略
    - 配置数据库自动备份
    - 配置静态资源备份
    - _需求：所有需求_

- [ ] 33. 最终检查点
  - 运行所有测试套件
  - 验证所有功能在生产环境正常工作
  - 验证性能指标达标
  - 验证可访问性合规
  - 如有问题请向用户反馈

## 注意事项

- 标记 `*` 的任务为可选任务，可以跳过以加快 MVP 开发
- 每个任务都引用了相关的需求编号
- 属性测试使用 fast-check 库，每个测试至少运行 100 次迭代
- 检查点任务用于确保增量开发的质量
- 所有测试必须通过才能继续下一阶段
